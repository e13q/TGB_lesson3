
# Dialogflow интеграция для бота Telegram и сообщества VK API

В данном проекте реализованы примеры автоматизации обработки обращений в телеграмм и VK на основе DialogFlow.

Dialogflow - это платформа для понимания естественного языка, используемая для разработки и интеграции разговорного пользовательского интерфейса в мобильные приложения, веб-приложения, устройства, боты, интерактивные системы голосового ответа и другие подобные приложения.


## Как установить

Python3 должен быть установлен. 
Используйте `pip` для установки зависимостей:
```
pip install -r requirements.txt
```

## Подготовка к запуску

### DialogFlow
Создайте проект [DialogFlow](https://dialogflow.cloud.google.com).

Создайте или выберите проект в Google Cloud Console:

    Перейдите на Google Cloud Console.
    Выберите существующий проект или создайте новый.

Перейдите в "API и сервисы" и создайте учетные данные:

    На левой панели навигации выберите "API и сервисы" > "Учетные данные".
    Нажмите на "Создать учетные данные" и выберите "Сервисный аккаунт".

Настройте сервисный аккаунт:

    Укажите имя и описание сервисного аккаунта, затем нажмите "Создать и продолжить".
    На следующем шаге назначьте необходимые роли для сервисного аккаунта.
    Нажмите "Продолжить", затем "Готово".

Создайте ключ для сервисного аккаунта:

    Найдите созданный сервисный аккаунт в списке.
    Нажмите на него, затем на вкладку "Ключи" и выберите "Добавить ключ" > "Создать новый ключ".
    Выберите формат JSON и нажмите "Создать".

Сохраните файл credentials.json:
    
    Файл автоматически загрузится на ваш компьютер. 
    Это и есть credentials.json, который вы используете для аутентификации в Google Cloud.

Не забудьте включить API для DialogFlow на данном ресурсе в разделе API

### Telegram

[Как получить токен для телеграмм бота.](https://way23.ru/%D1%80%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D0%B1%D0%BE%D1%82%D0%B0-%D0%B2-telegram.html).

Для получения логов потребуется ID пользователя Telegram, получить который можно написав на [@userinfobot](https://t.me/userinfobot) пункт "id".

### VK

В разделе настроек сообщества необходимо 

* Перейти в раздел API;
* Создать ключ API;
* Включить Long Pooling с фильтрацией по сообщениям;
* Разрешить сообщения для сообщества в настройках.

### Env

После получения всего необходимо создать в корневой папке проекта файл .env и добавить значения: 

```
TELEGRAM_MAIN_BOT_TOKEN = '0000000:AAGGGGGGEWIOGNWEIOGNIWEWE' # Токен бота для диалога с пользователем
TELEGRAM_LOGGER_BOT_TOKEN_TG = '0000000:AAGGGGGGEWIOGNWEIOGNIWEWE' # Токен бота для получения сообщения об ошибках бота Телеграмм
TELEGRAM_LOGGER_BOT_TOKEN_VK = '0000000:AAGGGGGGEWIOGNWEIOGNIWEWE' # Токен бота для получения сообщения об ошибках обработки запросов VK API
TELEGRAM_CHAT_ID = '123456789' # ID сотрудника, получающего сообщения об ошибках
GOOGLE_APPLICATION_CREDENTIALS = './key.json' # Адрес до ключа Google Cloud Console
DIALOGFLOW_PROJECT_ID = 'newagent-pyvi' # ID проекта DialogFlow
VK_GROUP_TOKEN = 'vk1.a.-***-5Q' # Токен API сообщества VK
```

### Обучение модели DialogFlow

В качествен примера данных используются [данные, предоставленные командой Devman](https://dvmn.org/media/filer_public/a7/db/a7db66c0-1259-4dac-9726-2d1fa9c44f20/questions.json).

Для автоматизации переноса данных можно воспользоваться скриптом load_intents_on_dialogflow.py в данном репозитории.

```Пример с локальным файлом
python3 load_intents_on_dialogflow.py --path ./questions.json
```

```Пример с URL
python3 load_intents_on_dialogflow.py --url https://dvmn.org/questions.json
```

## Запуск

Запустить скрипт для Телеграмм можно, выполнив команду:

```
python3 telegram_bot.py
```

Запустить скрипт для VK можно, выполнив команду:

```
python3 vk_bot.py
```

## Пример работы скрипта

### Telegram

![telegram](https://github.com/user-attachments/assets/cdd205b8-6fb4-4d41-92fa-c1120c27520b)

### VK

![vk](https://github.com/user-attachments/assets/16346269-7a1b-425b-878d-cdd788354475)


## Цель проекта

Код написан в образовательных целях на онлайн-курсе для веб-разработчиков [dvmn.org](https://dvmn.org/).
